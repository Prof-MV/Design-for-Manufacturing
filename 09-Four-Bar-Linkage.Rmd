# Four-Bar Linkages {#chap-09-linkages}

```{r setup-09, include=FALSE}
# include the helpers.R file for pdf output of youtube on pdfs as a clickable link
source("R/helpers.R")
# include the required packages to make sure the page can be built.
source("R/required_packages.R")

# Set a consistent theme for all plots
theme_linkage <- theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 10),
    axis.text = element_blank(),
    axis.title = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank(),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
```

## Learning Objectives {#sec:objectives-09}

By the end of this chapter, you will be able to:

1. **Identify** the components and terminology of four-bar linkage mechanisms
2. **Apply** Grashof's Law to classify four-bar linkages
3. **Distinguish** between crank-rocker, double-crank, rocker-crank, and triple-rocker mechanisms
4. **Analyze** linkage motion using position analysis techniques
5. **Select** appropriate linkage configurations for specific motion requirements

::: {.callout-think}
**Before You Read:** When you open a car hood, the hinges guide it through a specific path—rising up and forward—rather than just swinging in a simple arc. What mechanism might be hidden in the hinge to produce this carefully designed motion?
:::

## Introduction to Four-Bar Linkages {#sec:linkages-intro}

The **four-bar linkage** is one of the most fundamental and versatile mechanisms in mechanical engineering. Despite its apparent simplicity—just four rigid links connected by four revolute (pin) joints—it can produce an extraordinary variety of motions. Four-bar linkages are found in countless applications, from automobile suspensions to robotic arms, from aircraft landing gear to simple hand tools.

A four-bar linkage converts **rotary motion** into complex **output motion** that can be:

1. **Another rotation** (with variable angular velocity)
2. **Oscillating motion** (back-and-forth rotation)
3. **Complex path motion** (coupler curves)

***

> **Think About It:** When you open a car hood, the hinges guide it through a specific path—rising up and forward—rather than just swinging in a simple arc. This carefully designed motion comes from a four-bar linkage hidden in the hinge mechanism!

***

## Anatomy of a Four-Bar Linkage {-}

A four-bar linkage consists of four rigid members (links) connected in a closed loop by four revolute joints (pins).

```{r four-bar-anatomy, echo=FALSE, fig.width=10, fig.height=7, fig.align='center', fig.cap="Components of a four-bar linkage mechanism."}
# Define the four-bar linkage positions
# Ground pivots
O2 <- c(2, 2)     # Input crank pivot (fixed)
O4 <- c(8, 2)     # Output rocker pivot (fixed)

# Moving pivots (example position)
A <- c(3.5, 4)    # Connection between crank and coupler
B <- c(7, 4.5)    # Connection between coupler and rocker

ggplot() +
  # Ground (link 1) - shown as hatched/fixed
  geom_segment(aes(x = O2[1], xend = O4[1], y = O2[2], yend = O4[2]),
               linewidth = 3, color = "gray40") +
  # Ground hatching
  geom_segment(aes(x = seq(1.5, 8.5, 0.5), xend = seq(1.2, 8.2, 0.5),
                   y = rep(2, 15), yend = rep(1.6, 15)),
               linewidth = 0.5, color = "gray40") +

  # Input crank (link 2)
  geom_segment(aes(x = O2[1], xend = A[1], y = O2[2], yend = A[2]),
               linewidth = 4, color = "steelblue") +

  # Coupler (link 3)
  geom_segment(aes(x = A[1], xend = B[1], y = A[2], yend = B[2]),
               linewidth = 4, color = "orange") +

  # Output rocker (link 4)
  geom_segment(aes(x = O4[1], xend = B[1], y = O4[2], yend = B[2]),
               linewidth = 4, color = "forestgreen") +

  # Fixed pivots (ground joints)
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])),
             size = 8, color = "black") +
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])),
             size = 5, color = "white") +
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])),
             size = 2, color = "black") +

  # Moving pivots
  geom_point(aes(x = c(A[1], B[1]), y = c(A[2], B[2])),
             size = 7, color = "black") +
  geom_point(aes(x = c(A[1], B[1]), y = c(A[2], B[2])),
             size = 4, color = "white") +

  # Labels for links
  annotate("text", x = 5, y = 1.3, label = "Ground (Link 1) - Fixed",
           fontface = "bold", size = 3.5, color = "gray40") +
  annotate("text", x = 2.2, y = 3.3, label = "Input Crank\n(Link 2)",
           fontface = "bold", size = 3.5, color = "steelblue") +
  annotate("text", x = 5.2, y = 5, label = "Coupler (Link 3)",
           fontface = "bold", size = 3.5, color = "darkorange") +
  annotate("text", x = 8.2, y = 3.5, label = "Output\nRocker\n(Link 4)",
           fontface = "bold", size = 3.5, color = "forestgreen") +

  # Labels for pivots
  annotate("text", x = O2[1], y = O2[2] - 0.6, label = "O2", fontface = "bold", size = 4) +
  annotate("text", x = O4[1], y = O4[2] - 0.6, label = "O4", fontface = "bold", size = 4) +
  annotate("text", x = A[1] - 0.5, y = A[2] + 0.3, label = "A", fontface = "bold", size = 4) +
  annotate("text", x = B[1] + 0.5, y = B[2] + 0.3, label = "B", fontface = "bold", size = 4) +

  # Length labels
  annotate("text", x = 5, y = 2.4, label = "g (ground)", size = 3, fontface = "italic") +
  annotate("text", x = 2.4, y = 2.9, label = "a", size = 3, fontface = "italic") +
  annotate("text", x = 5.3, y = 4.1, label = "b", size = 3, fontface = "italic") +
  annotate("text", x = 7.8, y = 3, label = "c", size = 3, fontface = "italic") +

  # Input/Output arrows
  geom_curve(aes(x = 2, xend = 2.8, y = 1.2, yend = 1.6),
             arrow = arrow(length = unit(0.15, "cm"), type = "closed"),
             curvature = 0.3, linewidth = 1, color = "red") +
  annotate("text", x = 2.5, y = 0.9, label = "Input\nMotion", color = "red", size = 3) +

  geom_curve(aes(x = 8.7, xend = 8.2, y = 3, yend = 3.8),
             arrow = arrow(length = unit(0.15, "cm"), type = "closed"),
             curvature = -0.3, linewidth = 1, color = "purple") +
  annotate("text", x = 9.3, y = 3.5, label = "Output\nMotion", color = "purple", size = 3) +

  # Legend box
  geom_rect(aes(xmin = 0.5, xmax = 4.5, ymin = 5.5, ymax = 7.5),
            fill = "white", color = "black") +
  annotate("text", x = 2.5, y = 7.2, label = "LINK TERMINOLOGY", fontface = "bold", size = 3.5) +
  geom_segment(aes(x = 0.7, xend = 1.3, y = 6.7, yend = 6.7), linewidth = 3, color = "gray40") +
  annotate("text", x = 1.5, y = 6.7, label = "Ground (frame)", size = 2.8, hjust = 0) +
  geom_segment(aes(x = 0.7, xend = 1.3, y = 6.3, yend = 6.3), linewidth = 3, color = "steelblue") +
  annotate("text", x = 1.5, y = 6.3, label = "Input (crank/rocker)", size = 2.8, hjust = 0) +
  geom_segment(aes(x = 0.7, xend = 1.3, y = 5.9, yend = 5.9), linewidth = 3, color = "orange") +
  annotate("text", x = 1.5, y = 5.9, label = "Coupler (floating link)", size = 2.8, hjust = 0) +

  coord_fixed(ratio = 1, xlim = c(0, 10), ylim = c(0.5, 8)) +
  labs(title = "Four-Bar Linkage Anatomy") +
  theme_linkage
```

**Key Components:**

| Component | Symbol | Description |
|:----------|:-------|:------------|
| **Ground (Link 1)** | $g$ | Fixed link connecting the two ground pivots |
| **Input Link (Link 2)** | $a$ | Driven by motor or actuator; connected to ground at O2 |
| **Coupler (Link 3)** | $b$ | "Floating" link connecting the two moving pivots |
| **Output Link (Link 4)** | $c$ | Delivers output motion; connected to ground at O4 |
| **Ground Pivots** | O2, O4 | Fixed pivot points attached to the frame |
| **Moving Pivots** | A, B | Pivot points that move during operation |

***

## Grashof's Law {-}

**Grashof's Law** determines whether a four-bar linkage can achieve continuous rotation or is limited to oscillating (rocking) motion. This is the most fundamental criterion for classifying four-bar linkages.

### The Grashof Criterion {-}

For a four-bar linkage with link lengths $a$, $b$, $c$, and $g$:

$$S + L \leq P + Q$$

**Where:**

| Symbol | Definition |
|:-------|:-----------|
| $S$ | Length of the **shortest** link |
| $L$ | Length of the **longest** link |
| $P$ | Length of one remaining link |
| $Q$ | Length of the other remaining link |

***

### Classification by Grashof Condition {-}

```{r grashof-classification, echo=FALSE, fig.width=10, fig.height=8, fig.align='center', fig.cap="Classification of four-bar linkages based on Grashof's Law."}
ggplot() +
  # Main decision box
  geom_rect(aes(xmin = 3, xmax = 9, ymin = 9, ymax = 10.5), fill = "steelblue", color = "black") +
  annotate("text", x = 6, y = 10, label = "GRASHOF'S LAW", fontface = "bold", size = 5, color = "white") +
  annotate("text", x = 6, y = 9.4, label = "S + L  vs  P + Q", size = 4, color = "white") +

  # Connecting lines
  geom_segment(aes(x = 6, xend = 6, y = 9, yend = 8), linewidth = 1) +
  geom_segment(aes(x = 3, xend = 9, y = 8, yend = 8), linewidth = 1) +
  geom_segment(aes(x = 3, xend = 3, y = 8, yend = 7), linewidth = 1) +
  geom_segment(aes(x = 9, xend = 9, y = 8, yend = 7), linewidth = 1) +

  # Grashof condition box
  geom_rect(aes(xmin = 1, xmax = 5, ymin = 5.5, ymax = 7), fill = "lightgreen", color = "black") +
  annotate("text", x = 3, y = 6.6, label = "GRASHOF", fontface = "bold", size = 4, color = "darkgreen") +
  annotate("text", x = 3, y = 6, label = "S + L < P + Q", size = 3.5) +

  # Non-Grashof condition box
  geom_rect(aes(xmin = 7, xmax = 11, ymin = 5.5, ymax = 7), fill = "lightyellow", color = "black") +
  annotate("text", x = 9, y = 6.6, label = "NON-GRASHOF", fontface = "bold", size = 4, color = "darkorange") +
  annotate("text", x = 9, y = 6, label = "S + L > P + Q", size = 3.5) +

  # Grashof sub-types
  geom_segment(aes(x = 3, xend = 3, y = 5.5, yend = 4.5), linewidth = 0.5) +
  geom_segment(aes(x = 1, xend = 5, y = 4.5, yend = 4.5), linewidth = 0.5) +
  geom_segment(aes(x = c(1, 3, 5), xend = c(1, 3, 5), y = rep(4.5, 3), yend = rep(4, 3)), linewidth = 0.5) +

  # Crank-Rocker
  geom_rect(aes(xmin = -0.3, xmax = 2.3, ymin = 2, ymax = 4), fill = "palegreen", color = "black") +
  annotate("text", x = 1, y = 3.6, label = "Crank-Rocker", fontface = "bold", size = 3) +
  annotate("text", x = 1, y = 3.1, label = "Shortest = input", size = 2.5) +
  annotate("text", x = 1, y = 2.6, label = "Input: full rotation", size = 2.5) +
  annotate("text", x = 1, y = 2.2, label = "Output: oscillates", size = 2.5) +

  # Double-Crank
  geom_rect(aes(xmin = 1.7, xmax = 4.3, ymin = 2, ymax = 4), fill = "palegreen", color = "black") +
  annotate("text", x = 3, y = 3.6, label = "Double-Crank", fontface = "bold", size = 3) +
  annotate("text", x = 3, y = 3.1, label = "Shortest = ground", size = 2.5) +
  annotate("text", x = 3, y = 2.6, label = "Input: full rotation", size = 2.5) +
  annotate("text", x = 3, y = 2.2, label = "Output: full rotation", size = 2.5) +

  # Rocker-Crank
  geom_rect(aes(xmin = 3.7, xmax = 6.3, ymin = 2, ymax = 4), fill = "palegreen", color = "black") +
  annotate("text", x = 5, y = 3.6, label = "Rocker-Crank", fontface = "bold", size = 3) +
  annotate("text", x = 5, y = 3.1, label = "Shortest = output", size = 2.5) +
  annotate("text", x = 5, y = 2.6, label = "Input: oscillates", size = 2.5) +
  annotate("text", x = 5, y = 2.2, label = "Output: full rotation", size = 2.5) +

  # Triple-Rocker (Non-Grashof)
  geom_rect(aes(xmin = 7, xmax = 11, ymin = 2, ymax = 4.5), fill = "moccasin", color = "black") +
  annotate("text", x = 9, y = 4.1, label = "Triple-Rocker", fontface = "bold", size = 3.5) +
  annotate("text", x = 9, y = 3.5, label = "No link can fully rotate", size = 2.8) +
  annotate("text", x = 9, y = 3, label = "All links oscillate", size = 2.8) +
  annotate("text", x = 9, y = 2.5, label = "(Limited motion range)", size = 2.8) +

  # Special case
  geom_rect(aes(xmin = 3.5, xmax = 8.5, ymin = 0.3, ymax = 1.5), fill = "lavender", color = "black") +
  annotate("text", x = 6, y = 1.2, label = "SPECIAL CASE: S + L = P + Q", fontface = "bold", size = 3) +
  annotate("text", x = 6, y = 0.7, label = "Change-point mechanism (passes through dead points)", size = 2.8) +

  coord_fixed(ratio = 1, xlim = c(-1, 12), ylim = c(0, 11)) +
  theme_void()

```

***

### Grashof Classification Summary {-}

```{r grashof-table, echo=FALSE, message=FALSE}
grashof_types <- tribble(
  ~Type, ~Condition, ~Shortest_Link, ~Input_Motion, ~Output_Motion, ~Application,
  "Crank-Rocker", "S + L < P + Q", "Input link (a)", "Continuous rotation", "Oscillation", "Windshield wipers, pumps",
  "Double-Crank", "S + L < P + Q", "Ground (g)", "Continuous rotation", "Continuous rotation", "Locomotive wheels",
  "Rocker-Crank", "S + L < P + Q", "Output link (c)", "Oscillation", "Continuous rotation", "Treadle pumps",
  "Triple-Rocker", "S + L > P + Q", "Any", "Oscillation only", "Oscillation only", "Rocking mechanisms"
)

grashof_types %>%
  kbl(caption = "Four-Bar Linkage Classification by Grashof Condition",
      col.names = c("Type", "Condition", "Shortest Link", "Input", "Output", "Example Applications"),
      booktabs = TRUE) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"), full_width = TRUE) %>%
  row_spec(0, background = "#D81B60", color = "white") %>%
  row_spec(1:3, background = "#E8F5E9") %>%
  row_spec(4, background = "#FFF3E0")
```

***

## Types of Four-Bar Linkages {-}

### Crank-Rocker Mechanism {-}

The **crank-rocker** is the most common four-bar linkage configuration. The input link (crank) rotates continuously while the output link (rocker) oscillates back and forth.

```{r crank-rocker, echo=FALSE, fig.width=10, fig.height=6, fig.align='center', fig.cap="Crank-rocker mechanism: input rotates, output oscillates."}
# Show crank-rocker in multiple positions
ggplot() +
  # Ground
  geom_segment(aes(x = 2, xend = 8, y = 2, yend = 2), linewidth = 3, color = "gray40") +
  geom_segment(aes(x = seq(1.5, 8.5, 0.4), xend = seq(1.2, 8.2, 0.4),
                   y = rep(2, 18), yend = rep(1.7, 18)), linewidth = 0.5, color = "gray40") +

  # Position 1 (solid)
  geom_segment(aes(x = 2, xend = 3.2, y = 2, yend = 3.5), linewidth = 3, color = "steelblue") +
  geom_segment(aes(x = 3.2, xend = 7, y = 3.5, yend = 4.8), linewidth = 3, color = "orange") +
  geom_segment(aes(x = 8, xend = 7, y = 2, yend = 4.8), linewidth = 3, color = "forestgreen") +

  # Position 2 (dashed)
  geom_segment(aes(x = 2, xend = 0.8, y = 2, yend = 2.8), linewidth = 2, color = "steelblue", linetype = "dashed", alpha = 0.6) +
  geom_segment(aes(x = 0.8, xend = 5.5, y = 2.8, yend = 4.2), linewidth = 2, color = "orange", linetype = "dashed", alpha = 0.6) +
  geom_segment(aes(x = 8, xend = 5.5, y = 2, yend = 4.2), linewidth = 2, color = "forestgreen", linetype = "dashed", alpha = 0.6) +

  # Position 3 (dotted)
  geom_segment(aes(x = 2, xend = 2.5, y = 2, yend = 0.5), linewidth = 2, color = "steelblue", linetype = "dotted", alpha = 0.6) +
  geom_segment(aes(x = 2.5, xend = 6.8, y = 0.5, yend = 2.8), linewidth = 2, color = "orange", linetype = "dotted", alpha = 0.6) +
  geom_segment(aes(x = 8, xend = 6.8, y = 2, yend = 2.8), linewidth = 2, color = "forestgreen", linetype = "dotted", alpha = 0.6) +

  # Fixed pivots
  geom_point(aes(x = c(2, 8), y = c(2, 2)), size = 8, color = "black") +
  geom_point(aes(x = c(2, 8), y = c(2, 2)), size = 5, color = "white") +
  geom_point(aes(x = c(2, 8), y = c(2, 2)), size = 2, color = "black") +

  # Rotation arrows
  geom_curve(aes(x = 2, xend = 3.2, y = 0, yend = 0.3),
             arrow = arrow(length = unit(0.2, "cm"), type = "closed", ends = "both"),
             curvature = -0.5, linewidth = 1.2, color = "steelblue") +
  annotate("text", x = 2.6, y = -0.5, label = "360 deg rotation", color = "steelblue", fontface = "bold", size = 3) +

  geom_curve(aes(x = 8.8, xend = 8.5, y = 3, yend = 4.5),
             arrow = arrow(length = unit(0.2, "cm"), type = "closed", ends = "both"),
             curvature = 0.3, linewidth = 1.2, color = "forestgreen") +
  annotate("text", x = 9.5, y = 3.75, label = "Oscillation\n(~60-120 deg)", color = "forestgreen", fontface = "bold", size = 3) +

  # Labels
  annotate("text", x = 2, y = 5.8, label = "CRANK-ROCKER", fontface = "bold", size = 5) +
  annotate("text", x = 1.5, y = 2.8, label = "Crank", color = "steelblue", size = 3.5) +
  annotate("text", x = 9, y = 3.3, label = "Rocker", color = "forestgreen", size = 3.5) +

  # Application box
  geom_rect(aes(xmin = 5.5, xmax = 10, ymin = 5, ymax = 6.3), fill = "lightyellow", color = "black") +
  annotate("text", x = 7.75, y = 6, label = "Applications:", fontface = "bold", size = 3) +
  annotate("text", x = 5.7, y = 5.5, label = "Windshield wipers, sewing machines,\nreciprocating pumps", size = 2.8, hjust = 0) +

  coord_fixed(ratio = 1, xlim = c(-0.5, 10.5), ylim = c(-1, 6.5)) +
  theme_linkage
```

***

### Double-Crank (Drag-Link) Mechanism {-}

In a **double-crank** or **drag-link** mechanism, both the input and output links can rotate continuously. This occurs when the **ground link is the shortest**.

```{r double-crank, echo=FALSE, fig.width=10, fig.height=6, fig.align='center', fig.cap="Double-crank mechanism: both input and output rotate continuously."}
ggplot() +
  # Ground (shortest)
  geom_segment(aes(x = 4, xend = 6, y = 2, yend = 2), linewidth = 3, color = "gray40") +
  geom_segment(aes(x = seq(3.5, 6.5, 0.3), xend = seq(3.2, 6.2, 0.3),
                   y = rep(2, 11), yend = rep(1.7, 11)), linewidth = 0.5, color = "gray40") +

  # Position 1
  geom_segment(aes(x = 4, xend = 2.5, y = 2, yend = 4), linewidth = 3, color = "steelblue") +
  geom_segment(aes(x = 2.5, xend = 5.5, y = 4, yend = 5.5), linewidth = 3, color = "orange") +
  geom_segment(aes(x = 6, xend = 5.5, y = 2, yend = 5.5), linewidth = 3, color = "forestgreen") +

  # Position 2 (dashed)
  geom_segment(aes(x = 4, xend = 5.5, y = 2, yend = 0.5), linewidth = 2, color = "steelblue", linetype = "dashed", alpha = 0.6) +
  geom_segment(aes(x = 5.5, xend = 8.5, y = 0.5, yend = 2), linewidth = 2, color = "orange", linetype = "dashed", alpha = 0.6) +
  geom_segment(aes(x = 6, xend = 8.5, y = 2, yend = 2), linewidth = 2, color = "forestgreen", linetype = "dashed", alpha = 0.6) +

  # Fixed pivots
  geom_point(aes(x = c(4, 6), y = c(2, 2)), size = 8, color = "black") +
  geom_point(aes(x = c(4, 6), y = c(2, 2)), size = 5, color = "white") +
  geom_point(aes(x = c(4, 6), y = c(2, 2)), size = 2, color = "black") +

  # Rotation arrows - both 360
  geom_curve(aes(x = 3.2, xend = 4.5, y = 0.8, yend = 0.5),
             arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
             curvature = 0.4, linewidth = 1.2, color = "steelblue") +
  annotate("text", x = 3.8, y = 0.2, label = "360 deg", color = "steelblue", fontface = "bold", size = 3) +

  geom_curve(aes(x = 6.8, xend = 5.5, y = 0.8, yend = 0.5),
             arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
             curvature = -0.4, linewidth = 1.2, color = "forestgreen") +
  annotate("text", x = 6.2, y = 0.2, label = "360 deg", color = "forestgreen", fontface = "bold", size = 3) +

  # Labels
  annotate("text", x = 5, y = 6.5, label = "DOUBLE-CRANK (DRAG-LINK)", fontface = "bold", size = 5) +

  annotate("text", x = 5, y = 1.5, label = "Ground = shortest link", color = "gray40", fontface = "italic", size = 3.5) +

  # Key characteristic
  geom_rect(aes(xmin = 0.5, xmax = 3.5, ymin = 5, ymax = 6.3), fill = "lightgreen", color = "black") +
  annotate("text", x = 2, y = 6, label = "Key Feature:", fontface = "bold", size = 3) +
  annotate("text", x = 2, y = 5.4, label = "Non-uniform output velocity\nfrom uniform input", size = 2.8) +

  # Application box
  geom_rect(aes(xmin = 7, xmax = 10.5, ymin = 4, ymax = 5.5), fill = "lightyellow", color = "black") +
  annotate("text", x = 8.75, y = 5.2, label = "Applications:", fontface = "bold", size = 3) +
  annotate("text", x = 7.2, y = 4.6, label = "Locomotive coupling rods,\nparallel motion linkages", size = 2.8, hjust = 0) +

  coord_fixed(ratio = 1, xlim = c(0, 11), ylim = c(-0.5, 7)) +
  theme_linkage
```

***

### Triple-Rocker (Non-Grashof) {-}

When the Grashof condition is **not satisfied** ($S + L > P + Q$), no link can complete a full revolution. All links are restricted to oscillating (rocking) motion.

```{r triple-rocker, echo=FALSE, fig.width=10, fig.height=5, fig.align='center', fig.cap="Triple-rocker mechanism: all links oscillate, none can fully rotate."}
ggplot() +
  # Ground
  geom_segment(aes(x = 2, xend = 8, y = 2, yend = 2), linewidth = 3, color = "gray40") +
  geom_segment(aes(x = seq(1.5, 8.5, 0.4), xend = seq(1.2, 8.2, 0.4),
                   y = rep(2, 18), yend = rep(1.7, 18)), linewidth = 0.5, color = "gray40") +

  # Position 1
  geom_segment(aes(x = 2, xend = 3.5, y = 2, yend = 4), linewidth = 3, color = "steelblue") +
  geom_segment(aes(x = 3.5, xend = 6.5, y = 4, yend = 4.2), linewidth = 3, color = "orange") +
  geom_segment(aes(x = 8, xend = 6.5, y = 2, yend = 4.2), linewidth = 3, color = "forestgreen") +

  # Position 2 (showing limited range)
  geom_segment(aes(x = 2, xend = 2.8, y = 2, yend = 3.8), linewidth = 2, color = "steelblue", linetype = "dashed", alpha = 0.6) +
  geom_segment(aes(x = 2.8, xend = 6.2, y = 3.8, yend = 4.5), linewidth = 2, color = "orange", linetype = "dashed", alpha = 0.6) +
  geom_segment(aes(x = 8, xend = 6.2, y = 2, yend = 4.5), linewidth = 2, color = "forestgreen", linetype = "dashed", alpha = 0.6) +

  # Fixed pivots
  geom_point(aes(x = c(2, 8), y = c(2, 2)), size = 8, color = "black") +
  geom_point(aes(x = c(2, 8), y = c(2, 2)), size = 5, color = "white") +
  geom_point(aes(x = c(2, 8), y = c(2, 2)), size = 2, color = "black") +

  # Limited motion indicators
  geom_curve(aes(x = 2.3, xend = 3.3, y = 3.5, yend = 4.2),
             arrow = arrow(length = unit(0.15, "cm"), type = "closed", ends = "both"),
             curvature = 0.3, linewidth = 1, color = "red") +
  annotate("text", x = 1.2, y = 4, label = "Limited\nswing", color = "red", size = 3) +

  geom_curve(aes(x = 7.5, xend = 6.7, y = 3.8, yend = 4.5),
             arrow = arrow(length = unit(0.15, "cm"), type = "closed", ends = "both"),
             curvature = -0.3, linewidth = 1, color = "red") +
  annotate("text", x = 9, y = 4.2, label = "Limited\nswing", color = "red", size = 3) +

  # Labels
  annotate("text", x = 5, y = 5.5, label = "TRIPLE-ROCKER (Non-Grashof)", fontface = "bold", size = 5) +

  # Warning box
  geom_rect(aes(xmin = 3, xmax = 7, ymin = 0.5, ymax = 1.5), fill = "mistyrose", color = "darkred") +
  annotate("text", x = 5, y = 1.2, label = "S + L > P + Q", fontface = "bold", size = 3.5, color = "darkred") +
  annotate("text", x = 5, y = 0.8, label = "No continuous rotation possible", size = 3, color = "darkred") +

  coord_fixed(ratio = 1, xlim = c(0, 10), ylim = c(0, 6)) +
  theme_linkage
```

***

## Position Analysis {-}

Position analysis determines the configuration of a linkage for a given input angle. This is fundamental for understanding linkage motion and for design.

### Loop Closure Equation {-}

The four-bar linkage forms a closed vector loop:

$$\vec{a} + \vec{b} = \vec{g} + \vec{c}$$

In component form (x and y):

$$a \cos\theta_2 + b \cos\theta_3 = g + c \cos\theta_4$$
$$a \sin\theta_2 + b \sin\theta_3 = c \sin\theta_4$$

```{r vector-loop, echo=FALSE, fig.width=10, fig.height=6, fig.align='center', fig.cap="Vector loop closure for position analysis."}
# Define positions
O2 <- c(2, 2)
O4 <- c(8, 2)
A <- c(3.5, 4.2)
B <- c(7, 4.8)

ggplot() +
  # Ground reference
  geom_segment(aes(x = O2[1], xend = O4[1], y = O2[2], yend = O4[2]),
               linewidth = 1, color = "gray60", linetype = "dashed") +

  # Vector a (input)
  geom_segment(aes(x = O2[1], xend = A[1], y = O2[2], yend = A[2]),
               arrow = arrow(length = unit(0.3, "cm"), type = "closed"),
               linewidth = 2, color = "steelblue") +
  annotate("text", x = 2.3, y = 3.3, label = expression(vec(a)), size = 5, color = "steelblue", parse = FALSE) +
  annotate("text", x = 2.3, y = 3, label = "a", size = 5, color = "steelblue", fontface = "bold") +

  # Vector b (coupler)
  geom_segment(aes(x = A[1], xend = B[1], y = A[2], yend = B[2]),
               arrow = arrow(length = unit(0.3, "cm"), type = "closed"),
               linewidth = 2, color = "orange") +
  annotate("text", x = 5.2, y = 4.8, label = "b", size = 5, color = "darkorange", fontface = "bold") +

  # Vector c (output)
  geom_segment(aes(x = O4[1], xend = B[1], y = O4[2], yend = B[2]),
               arrow = arrow(length = unit(0.3, "cm"), type = "closed"),
               linewidth = 2, color = "forestgreen") +
  annotate("text", x = 7.8, y = 3.5, label = "c", size = 5, color = "forestgreen", fontface = "bold") +

  # Vector g (ground)
  geom_segment(aes(x = O2[1], xend = O4[1], y = O2[2] - 0.3, yend = O4[2] - 0.3),
               arrow = arrow(length = unit(0.3, "cm"), type = "closed"),
               linewidth = 2, color = "purple") +
  annotate("text", x = 5, y = 1.4, label = "g", size = 5, color = "purple", fontface = "bold") +

  # Angle theta2
  geom_curve(aes(x = 3, xend = 2.8, y = 2, yend = 2.5), curvature = -0.3, color = "steelblue", linewidth = 1) +
  annotate("text", x = 3.3, y = 2.5, label = expression(theta[2]), size = 4, color = "steelblue") +

  # Angle theta3
  geom_curve(aes(x = 4.2, xend = 4.5, y = 4.2, yend = 4.4), curvature = 0.3, color = "darkorange", linewidth = 1) +
  annotate("text", x = 4.7, y = 4, label = expression(theta[3]), size = 4, color = "darkorange") +

  # Angle theta4
  geom_curve(aes(x = 8.5, xend = 8, y = 2, yend = 2.8), curvature = 0.3, color = "forestgreen", linewidth = 1) +
  annotate("text", x = 8.7, y = 2.6, label = expression(theta[4]), size = 4, color = "forestgreen") +

  # Pivot points
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])), size = 6, color = "black") +
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])), size = 3, color = "white") +
  geom_point(aes(x = c(A[1], B[1]), y = c(A[2], B[2])), size = 5, color = "black") +
  geom_point(aes(x = c(A[1], B[1]), y = c(A[2], B[2])), size = 2, color = "white") +

  # Labels for pivots
  annotate("text", x = O2[1] - 0.3, y = O2[2] + 0.3, label = "O2", fontface = "bold", size = 4) +
  annotate("text", x = O4[1] + 0.3, y = O4[2] + 0.3, label = "O4", fontface = "bold", size = 4) +
  annotate("text", x = A[1], y = A[2] + 0.4, label = "A", fontface = "bold", size = 4) +
  annotate("text", x = B[1], y = B[2] + 0.4, label = "B", fontface = "bold", size = 4) +

  # Equation box
  geom_rect(aes(xmin = 0.5, xmax = 5, ymin = 5.5, ymax = 7), fill = "white", color = "black") +
  annotate("text", x = 2.75, y = 6.7, label = "Loop Closure:", fontface = "bold", size = 3.5) +
  annotate("text", x = 2.75, y = 6.2, label = "a + b = g + c", size = 4, fontface = "italic") +

  coord_fixed(ratio = 1, xlim = c(0, 10), ylim = c(1, 7.5)) +
  labs(title = "Vector Loop for Four-Bar Position Analysis") +
  theme_linkage
```

### Freudenstein's Equation {-}

**Freudenstein's Equation** provides a relationship between input angle $\theta_2$ and output angle $\theta_4$:

$$K_1 \cos\theta_4 - K_2 \cos\theta_2 + K_3 = \cos(\theta_2 - \theta_4)$$

**Where:**

$$K_1 = \frac{g}{c}, \quad K_2 = \frac{g}{a}, \quad K_3 = \frac{a^2 - b^2 + c^2 + g^2}{2ac}$$

This equation is particularly useful for **function generation** problems, where a specific input-output relationship is desired.

***

## Transmission Angle {-}

The **transmission angle** ($\mu$) is the angle between the coupler and the output link. It is a critical measure of linkage quality—how effectively force is transmitted through the mechanism.

```{r transmission-angle, echo=FALSE, fig.width=10, fig.height=6, fig.align='center', fig.cap="Transmission angle and its significance for linkage performance."}
# Positions
O2 <- c(2, 2)
O4 <- c(8, 2)
A <- c(3.5, 4)
B <- c(7, 4.5)

ggplot() +
  # Links
  geom_segment(aes(x = O2[1], xend = O4[1], y = O2[2], yend = O4[2]), linewidth = 2, color = "gray40") +
  geom_segment(aes(x = O2[1], xend = A[1], y = O2[2], yend = A[2]), linewidth = 3, color = "steelblue") +
  geom_segment(aes(x = A[1], xend = B[1], y = A[2], yend = B[2]), linewidth = 3, color = "orange") +
  geom_segment(aes(x = O4[1], xend = B[1], y = O4[2], yend = B[2]), linewidth = 3, color = "forestgreen") +

  # Extend output link to show angle clearly
  geom_segment(aes(x = B[1], xend = B[1] + 1.5, y = B[2], yend = B[2] + (B[2] - O4[2])/(B[1] - O4[1]) * 1.5),
               linewidth = 1, color = "forestgreen", linetype = "dashed") +

  # Transmission angle arc
  geom_curve(aes(x = B[1] - 0.8, xend = B[1] + 0.6, y = B[2] - 0.3, yend = B[2] + 0.5),
             curvature = -0.4, linewidth = 1.5, color = "red") +
  annotate("text", x = B[1] + 1, y = B[2] - 0.2, label = expression(mu), size = 6, color = "red") +
  annotate("text", x = B[1] + 1.5, y = B[2] - 0.6, label = "(Transmission\nAngle)", size = 3, color = "red") +

  # Pivots
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])), size = 7, color = "black") +
  geom_point(aes(x = c(O2[1], O4[1]), y = c(O2[2], O4[2])), size = 4, color = "white") +
  geom_point(aes(x = c(A[1], B[1]), y = c(A[2], B[2])), size = 6, color = "black") +
  geom_point(aes(x = c(A[1], B[1]), y = c(A[2], B[2])), size = 3, color = "white") +

  # Label at B
  annotate("text", x = B[1] - 0.5, y = B[2] + 0.5, label = "B", fontface = "bold", size = 4) +

  # Quality guidelines box
  geom_rect(aes(xmin = 0.5, xmax = 4.5, ymin = 5, ymax = 7.5), fill = "white", color = "black") +
  annotate("text", x = 2.5, y = 7.2, label = "DESIGN GUIDELINES", fontface = "bold", size = 3.5) +
  annotate("text", x = 0.7, y = 6.7, label = expression(paste("Ideal: ", mu, " = 90 deg")), size = 3, hjust = 0) +
  annotate("text", x = 0.7, y = 6.2, label = expression(paste("Good: 40 deg < ", mu, " < 140 deg")), size = 3, hjust = 0) +
  annotate("text", x = 0.7, y = 5.7, label = expression(paste("Minimum: ", mu, " > 30 deg")), size = 3, hjust = 0) +
  annotate("text", x = 0.7, y = 5.2, label = expression(paste("Avoid: ", mu, " near 0 deg or 180 deg")), size = 3, hjust = 0, color = "red") +

  # Note
  geom_rect(aes(xmin = 5.5, xmax = 10, ymin = 0.3, ymax = 1.5), fill = "lightyellow", color = "black") +
  annotate("text", x = 7.75, y = 1.2, label = "Why it matters:", fontface = "bold", size = 3) +
  annotate("text", x = 7.75, y = 0.7, label = "Poor transmission angle causes\nhigh joint forces and jerky motion", size = 2.8) +

  coord_fixed(ratio = 1, xlim = c(0, 10.5), ylim = c(0, 8)) +
  labs(title = "Transmission Angle in Four-Bar Linkage") +
  theme_linkage
```

### Transmission Angle Formula {-}

The transmission angle can be calculated using the **law of cosines**:

$$\cos\mu = \frac{b^2 + c^2 - (a^2 + g^2 - 2ag\cos\theta_2)}{2bc}$$

**Design Rules:**

| Transmission Angle | Quality | Recommendation |
|:-------------------|:--------|:---------------|
| $\mu = 90°$ | Optimal | Maximum force transmission |
| $40° < \mu < 140°$ | Good | Acceptable for most applications |
| $30° < \mu < 150°$ | Marginal | May need stronger components |
| $\mu < 30°$ or $\mu > 150°$ | Poor | Avoid—high forces, poor motion quality |

***

## Coupler Curves {-}

One of the most powerful features of four-bar linkages is the ability to generate complex curves using a point attached to the coupler link. These **coupler curves** can approximate straight lines, circles, or other complex shapes.

```{r coupler-curve-concept, echo=FALSE, fig.width=10, fig.height=7, fig.align='center', fig.cap="Coupler point P traces a coupler curve as the linkage moves."}
# Generate coupler curve data
# Link lengths (crank-rocker example)
a <- 1.5   # crank
b <- 4     # coupler
c <- 3     # rocker
g <- 5     # ground

# Coupler point location (relative to coupler)
p_dist <- 2.5  # distance from A along coupler direction
p_angle <- 0.4 # angle offset

# Calculate positions for range of input angles
theta2_range <- seq(0, 2*pi, length.out = 100)

# Simple approximation for visualization
coupler_x <- numeric(length(theta2_range))
coupler_y <- numeric(length(theta2_range))

for (i in seq_along(theta2_range)) {
  t2 <- theta2_range[i]
  # Approximate coupler point path (simplified)
  Ax <- a * cos(t2)
  Ay <- 2.5 + a * sin(t2)

  # Approximate B position using geometric constraints
  r <- sqrt((g - Ax)^2 + Ay^2)
  if (r < b + c && r > abs(b - c)) {
    phi <- atan2(Ay, g - Ax)
    alpha <- acos((r^2 + c^2 - b^2) / (2 * r * c))

    Bx <- g - c * cos(phi + alpha)
    By <- c * sin(phi + alpha)

    # Coupler point
    coupler_angle <- atan2(By - Ay, Bx - Ax) + p_angle
    coupler_x[i] <- Ax + p_dist * cos(coupler_angle)
    coupler_y[i] <- Ay + p_dist * sin(coupler_angle)
  }
}

# Remove invalid points
valid <- coupler_x != 0
coupler_data <- data.frame(x = coupler_x[valid], y = coupler_y[valid])

ggplot() +
  # Coupler curve
  geom_path(data = coupler_data, aes(x = x + 2, y = y),
            linewidth = 2, color = "red", alpha = 0.8) +

  # One position of linkage
  # Ground
  geom_segment(aes(x = 2, xend = 7, y = 2.5, yend = 2.5), linewidth = 2, color = "gray40") +
  geom_segment(aes(x = seq(1.5, 7.5, 0.4), xend = seq(1.2, 7.2, 0.4),
                   y = rep(2.5, 16), yend = rep(2.2, 16)), linewidth = 0.5, color = "gray40") +

  # Links at one position
  geom_segment(aes(x = 2, xend = 3.3, y = 2.5, yend = 3.8), linewidth = 3, color = "steelblue") +
  geom_segment(aes(x = 3.3, xend = 6.2, y = 3.8, yend = 4.5), linewidth = 3, color = "orange") +
  geom_segment(aes(x = 7, xend = 6.2, y = 2.5, yend = 4.5), linewidth = 3, color = "forestgreen") +

  # Coupler point P
  geom_point(aes(x = 4.5, y = 5.2), size = 8, color = "red") +
  geom_point(aes(x = 4.5, y = 5.2), size = 4, color = "white") +
  annotate("text", x = 4.5, y = 5.7, label = "P", fontface = "bold", size = 5, color = "red") +

  # Coupler extension to P
  geom_segment(aes(x = 3.3, xend = 4.5, y = 3.8, yend = 5.2),
               linewidth = 2, color = "orange", linetype = "dashed") +

  # Fixed pivots
  geom_point(aes(x = c(2, 7), y = c(2.5, 2.5)), size = 7, color = "black") +
  geom_point(aes(x = c(2, 7), y = c(2.5, 2.5)), size = 4, color = "white") +

  # Labels
  annotate("text", x = 5, y = 7.5, label = "COUPLER CURVE", fontface = "bold", size = 5) +
  annotate("text", x = 5, y = 7, label = "Path traced by coupler point P", size = 3.5) +

  # Arrow pointing to curve
  geom_curve(aes(x = 6.5, xend = 5.5, y = 6, yend = 5.5),
             arrow = arrow(length = unit(0.2, "cm"), type = "closed"),
             curvature = 0.3, linewidth = 1, color = "red") +
  annotate("text", x = 7, y = 6.2, label = "Coupler\ncurve", size = 3, color = "red") +

  coord_fixed(ratio = 1, xlim = c(0, 10), ylim = c(1.5, 8)) +
  theme_linkage
```

### Famous Coupler Curves {-}

```{r coupler-types-table, echo=FALSE, message=FALSE}
coupler_types <- tribble(
  ~Name, ~Shape, ~Application, ~Description,
  "Watt's Curve", "Figure-8 with straight segment", "Steam engine guides", "Approximate straight line over portion of path",
  "Roberts' Curve", "Symmetrical with straight portion", "Mechanism design", "Three-point straight line approximation",
  "Chebyshev Linkage", "Nearly straight line", "Drafting machines, presses", "Very accurate straight line approximation",
  "Hoeken's Linkage", "Extended straight portion", "Film projectors", "Long straight portion with low deviation",
  "Lambda Mechanism", "Complex curve with dwell", "Indexing mechanisms", "Output dwells while input continues"
)

coupler_types %>%
  kbl(caption = "Famous Four-Bar Coupler Curve Mechanisms",
      booktabs = TRUE) %>%
  kable_styling(latex_options = "hold_position", full_width = TRUE) %>%
  row_spec(0, background = "#D81B60", color = "white")
```

***

\newpage

## Applied Example: Grashof Classification {#linkage-example-1}

::: {.question}
##### Problem Statement {-}
:::

A four-bar linkage has the following link lengths:
- Link 1 (ground): $g = 100$ mm
- Link 2 (input): $a = 40$ mm
- Link 3 (coupler): $b = 80$ mm
- Link 4 (output): $c = 60$ mm

Determine:
1. Whether this is a Grashof or non-Grashof linkage
2. The type of mechanism (crank-rocker, double-crank, etc.)
3. Which link should be the input for continuous rotation

::: {.answer}
##### Solution {-}
:::

```{r grashof-example-calc, echo=FALSE, message=FALSE}
# Given link lengths
g <- 100  # ground
a <- 40   # input
b <- 80   # coupler
c <- 60   # output

# Sort to find S and L
links <- c(a, b, c, g)
link_names <- c("a (input)", "b (coupler)", "c (output)", "g (ground)")
sorted_idx <- order(links)

S <- links[sorted_idx[1]]
S_name <- link_names[sorted_idx[1]]
L <- links[sorted_idx[4]]
L_name <- link_names[sorted_idx[4]]
P <- links[sorted_idx[2]]
Q <- links[sorted_idx[3]]

# Grashof check
SL <- S + L
PQ <- P + Q

is_grashof <- SL <= PQ

# Determine mechanism type
if (is_grashof) {
  if (S_name == "g (ground)") {
    mech_type <- "Double-Crank"
  } else if (S_name == "a (input)") {
    mech_type <- "Crank-Rocker"
  } else if (S_name == "c (output)") {
    mech_type <- "Rocker-Crank"
  } else {
    mech_type <- "Double-Rocker"
  }
} else {
  mech_type <- "Triple-Rocker (Non-Grashof)"
}

# Create results table
results <- tribble(
  ~Step, ~Calculation, ~Result,
  "1. Identify shortest (S)", paste0("S = min(", a, ", ", b, ", ", c, ", ", g, ")"), paste0(S, " mm (", S_name, ")"),
  "2. Identify longest (L)", paste0("L = max(", a, ", ", b, ", ", c, ", ", g, ")"), paste0(L, " mm (", L_name, ")"),
  "3. Calculate S + L", paste0("S + L = ", S, " + ", L), paste0(SL, " mm"),
  "4. Calculate P + Q", paste0("P + Q = ", P, " + ", Q), paste0(PQ, " mm"),
  "5. Compare (Grashof test)", paste0("S + L (", SL, ") vs P + Q (", PQ, ")"),
  ifelse(SL < PQ, "S + L < P + Q: GRASHOF", ifelse(SL == PQ, "S + L = P + Q: CHANGE POINT", "S + L > P + Q: NON-GRASHOF")),
  "6. Mechanism type", "Based on shortest link position", mech_type
)

results %>%
  kbl(caption = "Grashof Classification Example",
      booktabs = TRUE,
      col.names = c("Step", "Calculation", "Result")) %>%
  kable_styling(latex_options = "hold_position", full_width = TRUE) %>%
  row_spec(0, background = "#D81B60", color = "white") %>%
  row_spec(5, background = "#E8F5E9", bold = TRUE) %>%
  row_spec(6, background = "#E3F2FD", bold = TRUE)
```

##### Interpretation {-}

- Since $S + L$ (`r SL` mm) is less than $P + Q$ (`r PQ` mm), this is a **Grashof linkage**.
- The shortest link is the **input link (a = `r a` mm)**.
- When the shortest link is the input (crank), the mechanism is a **Crank-Rocker**.
- The input (link 2) will rotate continuously while the output (link 4) oscillates.

***

## Applied Example: Transmission Angle Analysis {#linkage-example-2}

::: {.question}
##### Problem Statement {-}
:::

For the linkage in the previous example (a = 40, b = 80, c = 60, g = 100 mm), calculate the transmission angle when the input is at:
1. $\theta_2 = 60°$
2. Determine the minimum transmission angle through the full rotation

::: {.answer}
##### Solution {-}
:::

```{r trans-angle-example, echo=FALSE, message=FALSE}
# Given
a <- 40
b <- 80
c <- 60
g <- 100

# Function to calculate transmission angle
calc_trans_angle <- function(theta2, a, b, c, g) {
  # Convert to radians
  t2 <- theta2 * pi / 180

  # Calculate diagonal (distance from O4 to A)
  # Using law of cosines
  diag_sq <- a^2 + g^2 - 2*a*g*cos(t2)

  # Transmission angle using law of cosines
  cos_mu <- (b^2 + c^2 - diag_sq) / (2*b*c)

  # Clamp to valid range
  cos_mu <- max(-1, min(1, cos_mu))

  mu <- acos(cos_mu) * 180 / pi
  return(mu)
}

# Calculate for theta2 = 60 deg
mu_60 <- calc_trans_angle(60, a, b, c, g)

# Find min and max through full rotation
theta2_range <- seq(0, 360, by = 1)
mu_values <- sapply(theta2_range, calc_trans_angle, a = a, b = b, c = c, g = g)
mu_min <- min(mu_values, na.rm = TRUE)
mu_max <- max(mu_values, na.rm = TRUE)
theta_at_min <- theta2_range[which.min(mu_values)]

# Results table
trans_results <- tribble(
  ~Parameter, ~Formula, ~Value,
  "At theta2 = 60 deg", "cos(mu) = (b^2 + c^2 - f^2) / 2bc", paste0(round(mu_60, 1), " deg"),
  "Minimum transmission angle", "Through full crank rotation", paste0(round(mu_min, 1), " deg"),
  "Maximum transmission angle", "Through full crank rotation", paste0(round(mu_max, 1), " deg"),
  "Input angle at min mu", "theta2 where mu is minimum", paste0(round(theta_at_min, 1), " deg")
)

trans_results %>%
  kbl(caption = "Transmission Angle Analysis",
      booktabs = TRUE,
      col.names = c("Parameter", "Formula/Description", "Value")) %>%
  kable_styling(latex_options = "hold_position", full_width = TRUE) %>%
  row_spec(0, background = "#D81B60", color = "white") %>%
  row_spec(2, background = ifelse(mu_min > 40, "#E8F5E9", "#FFEBEE"), bold = TRUE)
```

##### Quality Assessment {-}

```{r quality-assessment, echo=FALSE, message=FALSE}
if (mu_min > 40) {
  quality <- "GOOD"
  recommendation <- "Minimum transmission angle exceeds 40 deg - acceptable design"
  color <- "darkgreen"
} else if (mu_min > 30) {
  quality <- "MARGINAL"
  recommendation <- "Consider redesigning for better force transmission"
  color <- "orange"
} else {
  quality <- "POOR"
  recommendation <- "Redesign required - excessive joint forces at minimum transmission angle"
  color <- "red"
}
```

**Design Quality:** `r quality`

**Recommendation:** `r recommendation`

***

## Design Guidelines {-}

### Link Length Selection {-}

| Design Goal | Guideline |
|:------------|:----------|
| **Continuous crank rotation** | Ensure Grashof condition: $S + L \leq P + Q$ |
| **Crank-rocker mechanism** | Make the input link the shortest |
| **Good transmission angle** | Keep $\mu_{min} > 40°$ throughout motion |
| **Avoid toggle positions** | Transmission angle should not approach 0° or 180° |
| **Symmetrical output** | Consider time ratio requirements |

### Time Ratio {-}

The **time ratio** (TR) describes how the output motion is divided between forward and return strokes:

$$TR = \frac{\text{Time for forward stroke}}{\text{Time for return stroke}} = \frac{\alpha}{\beta}$$

Where $\alpha$ and $\beta$ are the crank angles for forward and return strokes.

For a **quick-return mechanism**, TR > 1, meaning the return stroke is faster than the forward stroke.

***

## Summary Equations {-}

### Grashof Classification {-}

| Equation | Description |
|:---------|:------------|
| $S + L \leq P + Q$ | Grashof condition for continuous rotation |
| $S$ = shortest, $L$ = longest | Identify extreme link lengths |

### Position Analysis {-}

| Equation | Description |
|:---------|:------------|
| $a\cos\theta_2 + b\cos\theta_3 = g + c\cos\theta_4$ | X-component loop closure |
| $a\sin\theta_2 + b\sin\theta_3 = c\sin\theta_4$ | Y-component loop closure |
| $K_1\cos\theta_4 - K_2\cos\theta_2 + K_3 = \cos(\theta_2 - \theta_4)$ | Freudenstein's equation |

### Transmission Angle {-}

| Equation | Description |
|:---------|:------------|
| $\cos\mu = \frac{b^2 + c^2 - f^2}{2bc}$ | Transmission angle from diagonal |
| $f^2 = a^2 + g^2 - 2ag\cos\theta_2$ | Diagonal length squared |

***

## Design Checklist {-}

**For Four-Bar Linkage Design:**

- [ ] Define the motion requirement (continuous rotation, oscillation, path)
- [ ] Apply Grashof's Law to classify mechanism type
- [ ] Verify $S + L < P + Q$ for crank-rocker applications
- [ ] Calculate transmission angle range through full motion
- [ ] Ensure $\mu_{min} > 40°$ for good force transmission
- [ ] Check for toggle positions (dead points)
- [ ] Verify link proportions avoid interference
- [ ] Consider time ratio for quick-return applications
- [ ] Analyze coupler curve if path generation is required
- [ ] Check that mechanism fits within available space

***

## Common Applications {-}

```{r applications-table, echo=FALSE, message=FALSE}
applications <- tribble(
  ~Application, ~Mechanism_Type, ~Function, ~Key_Feature,
  "Windshield wipers", "Crank-rocker", "Convert motor rotation to blade oscillation", "Consistent sweep angle",
  "Automobile suspension", "Four-bar variant", "Control wheel motion during travel", "Maintains wheel orientation",
  "Aircraft landing gear", "Four-bar linkage", "Retract/extend gear in specific path", "Compact stowage",
  "Reciprocating pumps", "Crank-rocker", "Convert rotation to linear pumping", "Smooth motion transfer",
  "Sewing machines", "Crank-rocker", "Drive needle up/down motion", "Precise positioning",
  "Excavator bucket", "Four-bar linkage", "Control bucket angle during digging", "Force amplification",
  "Door closers", "Four-bar linkage", "Control closing speed and force", "Damped motion"
)

applications %>%
  kbl(caption = "Common Four-Bar Linkage Applications",
      booktabs = TRUE) %>%
  kable_styling(latex_options = c("hold_position", "scale_down"), full_width = TRUE) %>%
  row_spec(0, background = "#D81B60", color = "white")
```
